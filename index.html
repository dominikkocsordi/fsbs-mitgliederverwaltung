<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Mitgliederportal</title>

<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<style>
:root{
  --bg1:#0f2027;
  --bg2:#203a43;
  --bg3:#2c5364;
  --glass:rgba(255,255,255,.12);
  --glass-border:rgba(255,255,255,.25);
  --accent:#7dd3fc;
  --danger:#fb7185;
}

*{box-sizing:border-box}

body{
  margin:0;
  min-height:100vh;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:linear-gradient(135deg,var(--bg1),var(--bg2),var(--bg3));
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:flex-start;
  padding:40px 16px;
}

.app{
  width:100%;
  max-width:1100px;
}

h1{
  font-size:32px;
  margin:0 0 6px;
  letter-spacing:.4px;
}

.subtitle{
  opacity:.75;
  margin-bottom:24px;
}

.glass{
  background:var(--glass);
  backdrop-filter:blur(18px);
  -webkit-backdrop-filter:blur(18px);
  border:1px solid var(--glass-border);
  border-radius:20px;
  padding:20px;
  margin-bottom:20px;
  box-shadow:0 20px 40px rgba(0,0,0,.35);
}

.row{
  display:flex;
  gap:12px;
  flex-wrap:wrap;
  align-items:center;
}

input,select{
  background:rgba(255,255,255,.15);
  border:1px solid var(--glass-border);
  color:white;
  padding:12px 14px;
  border-radius:14px;
  outline:none;
  min-width:180px;
}

input::placeholder{color:rgba(255,255,255,.6)}

button{
  background:linear-gradient(135deg,#38bdf8,#0ea5e9);
  border:none;
  color:#002b3d;
  font-weight:600;
  padding:12px 18px;
  border-radius:14px;
  cursor:pointer;
  transition:.2s ease;
}

button:hover{transform:translateY(-1px);opacity:.95}

button.secondary{
  background:rgba(255,255,255,.15);
  color:white;
}

button.danger{
  background:linear-gradient(135deg,#fb7185,#e11d48);
  color:white;
}

.spacer{flex:1}

.badge{
  padding:6px 12px;
  border-radius:999px;
  font-size:13px;
  background:rgba(255,255,255,.2);
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:10px;
}

th,td{
  padding:14px 10px;
  border-bottom:1px solid rgba(255,255,255,.15);
}

th{opacity:.7;text-align:left}

.hidden{display:none}

.status{
  padding:6px 12px;
  border-radius:999px;
  font-size:13px;
  background:rgba(255,255,255,.25);
}

@media(max-width:700px){
  h1{font-size:26px}
}
</style>
</head>

<body>
<div class="app">

  <h1>Mitgliederportal</h1>
  <div class="subtitle">Sicher ¬∑ Modern ¬∑ Intern</div>

  <!-- LOGIN -->
  <div class="glass">
    <div class="row">
      <input id="loginEmail" placeholder="Email">
      <input id="loginPass" type="password" placeholder="Passwort">
      <button onclick="login()">Login</button>
      <button class="secondary hidden" id="logoutBtn" onclick="logout()">Logout</button>
      <div class="spacer"></div>
      <span class="badge" id="authStatus">nicht eingeloggt</span>
    </div>
  </div>

  <!-- APP -->
  <div class="glass hidden" id="app">

    <div class="row">
      <input id="first" placeholder="Vorname">
      <input id="last" placeholder="Nachname">
      <input id="mail" placeholder="Email">
      <select id="status">
        <option>aktiv</option>
        <option>pausiert</option>
        <option>ausgetreten</option>
      </select>
      <button onclick="save()">Speichern</button>
      <button class="secondary hidden" id="cancelBtn" onclick="cancel()">Abbrechen</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Status</th>
          <th>Aktion</th>
        </tr>
      </thead>
      <tbody id="list"></tbody>
    </table>

  </div>

</div>

<script>
const SUPABASE_URL = "https://hdhueuihmxbskiusenpe.supabase.co";
const SUPABASE_KEY = "sb_publishable_H6YjVStNvwY-VnZuZCYDxw_mOWEvAAW";
const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

let members=[], editId=null;

async function login(){
  const {error}=await sb.auth.signInWithPassword({
    email:loginEmail.value,
    password:loginPass.value
  });
  if(error)return alert(error.message);
  authStatus.textContent="eingeloggt";
  logoutBtn.classList.remove("hidden");
  document.getElementById("app").classList.remove("hidden");
  load();
}

async function logout(){
  await sb.auth.signOut();
  location.reload();
}

async function load(){
  const {data}=await sb.from("members").select("*").order("id",{ascending:false});
  members=data||[];
  render();
}

function render(){
  list.innerHTML=members.map(m=>`
    <tr>
      <td>${m.first_name} ${m.last_name}</td>
      <td>${m.email||""}</td>
      <td><span class="status">${m.status}</span></td>
      <td>
        <button class="secondary" onclick="edit(${m.id})">‚úèÔ∏è</button>
        <button class="danger" onclick="del(${m.id})">üóëÔ∏è</button>
      </td>
    </tr>
  `).join("");
}

function edit(id){
  const m=members.find(x=>x.id===id);
  editId=id;
  first.value=m.first_name;
  last.value=m.last_name;
  mail.value=m.email||"";
  status.value=m.status;
  cancelBtn.classList.remove("hidden");
}

function cancel(){
  editId=null;
  first.value=last.value=mail.value="";
  cancelBtn.classList.add("hidden");
}

async function save(){
  if(editId){
    await sb.from("members").update({
      first_name:first.value,
      last_name:last.value,
      email:mail.value,
      status:status.value
    }).eq("id",editId);
  }else{
    await sb.from("members").insert({
      first_name:first.value,
      last_name:last.value,
      email:mail.value,
      status:status.value
    });
  }
  cancel();
  load();
}

async function del(id){
  if(confirm("Wirklich l√∂schen?")){
    await sb.from("members").delete().eq("id",id);
    load();
  }
}
</script>
</body>
</html>
