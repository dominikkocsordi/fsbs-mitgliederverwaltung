<!doctype html>
<html lang="de">
<head>
    <meta charset="utf-8">
    <title>Mitgliederverwaltung</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body{font-family:system-ui;margin:30px;max-width:900px}
        input,select,button{padding:8px;margin:4px}
        table{width:100%;border-collapse:collapse;margin-top:16px}
        th,td{border:1px solid #ccc;padding:8px}
    </style>
</head>
<body>

<h1>Mitgliederverwaltung (Supabase)</h1>

<div style="margin:12px 0;">
  <input id="loginEmail" placeholder="Email">
  <input id="loginPass" type="password" placeholder="Passwort">
  <button onclick="signIn()">Login</button>
  <button onclick="signOut()">Logout</button>
  <span id="authStatus" style="margin-left:8px;"></span>
</div>
    
<input id="first" placeholder="Vorname">
<input id="last" placeholder="Nachname">
<input id="mail" placeholder="Email">
<select id="status">
    <option>aktiv</option>
    <option>pausiert</option>
    <option>ausgetreten</option>
</select>
<button onclick="add()">Speichern</button>

<table>
    <thead>
    <tr><th>Name</th><th>Email</th><th>Status</th></tr>
    </thead>
    <tbody id="list"></tbody>
</table>

<script>
    const SUPABASE_URL = "https://hdhueuihmxbskiusenpe.supabase.co";
    const SUPABASE_KEY = "sb_publishable_H6YjVStNvwY-VnZuZCYDxw_mOWEvAAW";

    const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

function setStatus(t){ document.getElementById("authStatus").textContent = t; }

async function signIn(){
  const email = loginEmail.value.trim();
  const password = loginPass.value;
  const { error } = await sb.auth.signInWithPassword({ email, password });
  if (error) return alert(error.message);
  setStatus("Eingeloggt ✅");
  load();
}

async function signOut(){
  await sb.auth.signOut();
  setStatus("Ausgeloggt");
  list.innerHTML = "";
}

async function requireAuth(){
  const { data } = await sb.auth.getSession();
  if (!data.session) throw new Error("Bitte erst einloggen.");
}

async function load(){
  try { await requireAuth(); }
  catch(e){ setStatus(e.message); return; }

  const { data, error } = await sb.from("members").select("*").order("id", { ascending:false });
  if (error) return alert("LOAD: " + error.message);

  list.innerHTML = data.map(m => `
    <tr>
      <td>${m.first_name} ${m.last_name}</td>
      <td>${m.email || ""}</td>
      <td>${m.status}</td>
    </tr>
  `).join("");
}

async function add(){
  try { await requireAuth(); }
  catch(e){ alert(e.message); return; }

  const { error } = await sb.from("members").insert({
    first_name: first.value,
    last_name: last.value,
    email: mail.value,
    status: status.value
  });

  if (error) return alert("INSERT: " + error.message);
  first.value = last.value = mail.value = "";
  load();
}

// Beim Laden: Status anzeigen
sb.auth.getSession().then(({data}) => setStatus(data.session ? "Eingeloggt ✅" : "Bitte einloggen"));
</script>

</body>
</html>
